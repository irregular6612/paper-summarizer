<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paper Summary Pipeline - Architecture Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #00d4ff;
            margin-bottom: 10px;
            font-size: 2.2em;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        .diagram-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .diagram-section h2 {
            color: #ff6b6b;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 107, 107, 0.3);
        }
        .mermaid {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        .file-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .file-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #00d4ff;
        }
        .file-card h3 {
            color: #00d4ff;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .file-card code {
            background: rgba(0, 212, 255, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            color: #7dd3fc;
        }
        .file-card ul {
            margin-left: 20px;
            margin-top: 10px;
        }
        .file-card li {
            margin-bottom: 5px;
            color: #ccc;
        }
        .ollama-highlight {
            background: linear-gradient(90deg, rgba(255, 107, 107, 0.2), rgba(255, 217, 61, 0.2));
            border-left: 4px solid #ff6b6b;
        }
        .ollama-highlight h3 {
            color: #ff6b6b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“„ Paper Summary Pipeline</h1>
        <p class="subtitle">ë…¼ë¬¸ PDF â†’ Obsidian ë§ˆí¬ë‹¤ìš´ ë³€í™˜ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜</p>

        <!-- ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ -->
        <div class="diagram-section">
            <h2>ğŸ—ï¸ ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜</h2>
            <div class="mermaid">
flowchart TB
    subgraph INPUT["ğŸ“¥ ì…ë ¥"]
        PDF["ğŸ“„ PDF íŒŒì¼"]
        CONFIG["âš™ï¸ config.yaml"]
    end

    subgraph MAIN["ğŸš€ main.py - CLI ì§„ì…ì "]
        direction TB
        CMD_PROCESS["process<br/><small>ë‹¨ì¼ PDF ì²˜ë¦¬</small>"]
        CMD_ALL["process-all<br/><small>í´ë” ë‚´ ëª¨ë“  PDF</small>"]
        CMD_WATCH["watch<br/><small>í´ë” ê°ì‹œ ëª¨ë“œ</small>"]
        CMD_INIT["init<br/><small>ì„¤ì • íŒŒì¼ ìƒì„±</small>"]
    end

    subgraph PIPELINE["âš¡ pipeline.py - PaperPipeline"]
        direction TB
        STEP1["<b>1/4</b> PDF êµ¬ì¡° ì¶”ì¶œ"]

        subgraph PARALLEL["ğŸ”€ ë³‘ë ¬ ì²˜ë¦¬ (ThreadPoolExecutor)"]
            STEP2["<b>2/4</b> ì´ë¯¸ì§€ ë‚´ë³´ë‚´ê¸°"]
            STEP3["<b>3/4</b> LLM ìš”ì•½ ìƒì„±"]
            META["ë©”íƒ€ë°ì´í„° ì¶”ì¶œ"]
        end

        STEP4["<b>4/4</b> ë§ˆí¬ë‹¤ìš´ ìƒì„±"]

        STEP1 --> PARALLEL
        PARALLEL --> STEP4
    end

    subgraph MODULES["ğŸ“¦ í•µì‹¬ ëª¨ë“ˆ"]
        EXT["extractor.py<br/><small>PDFExtractor</small>"]
        IMG["image_export.py<br/><small>ImageExporter</small>"]
        SUM["summarizer.py<br/><small>Summarizer</small>"]
        MD["markdown_gen.py<br/><small>MarkdownGenerator</small>"]
        WATCH["watcher.py<br/><small>FolderWatcher</small>"]
    end

    subgraph EXTERNAL["ğŸ”Œ ì™¸ë¶€ ì˜ì¡´ì„±"]
        MARKER["marker-pdf<br/><small>PDF íŒŒì‹±</small>"]
        LITELLM["litellm<br/><small>LLM í†µí•©</small>"]
        OLLAMA["ğŸ¦™ <b>Ollama</b><br/><small>qwen3:14b</small>"]
        WATCHDOG["watchdog<br/><small>íŒŒì¼ ê°ì‹œ</small>"]
    end

    subgraph OUTPUT["ğŸ“¤ ì¶œë ¥"]
        MD_FILE["ğŸ“ Obsidian ë§ˆí¬ë‹¤ìš´"]
        ASSETS["ğŸ–¼ï¸ assets/ í´ë”<br/><small>Figure, Table ì´ë¯¸ì§€</small>"]
    end

    PDF --> MAIN
    CONFIG --> MAIN
    MAIN --> PIPELINE

    STEP1 -.-> EXT
    STEP2 -.-> IMG
    STEP3 -.-> SUM
    META -.-> SUM
    STEP4 -.-> MD
    CMD_WATCH -.-> WATCH

    EXT --> MARKER
    SUM --> LITELLM
    LITELLM --> OLLAMA
    WATCH --> WATCHDOG

    PIPELINE --> OUTPUT

    style OLLAMA fill:#ff6b6b,stroke:#ff4757,stroke-width:3px,color:#fff
    style STEP3 fill:#ffe066,stroke:#ffd43b,stroke-width:2px
    style META fill:#ffe066,stroke:#ffd43b,stroke-width:2px
    style PARALLEL fill:#e3f2fd,stroke:#64b5f6
            </div>
        </div>

        <!-- ìƒì„¸ ì²˜ë¦¬ íë¦„ -->
        <div class="diagram-section">
            <h2>ğŸ”„ ìƒì„¸ ì²˜ë¦¬ íë¦„ (process ëª…ë ¹)</h2>
            <div class="mermaid">
flowchart LR
    subgraph EXTRACT["<b>1ë‹¨ê³„: ì¶”ì¶œ</b><br/>extractor.py"]
        direction TB
        E1["PDF ë¡œë“œ"]
        E2["marker-pdf ë³€í™˜"]
        E3["PaperStructure ìƒì„±"]
        E1 --> E2 --> E3
    end

    subgraph PARALLEL["<b>2-3ë‹¨ê³„: ë³‘ë ¬ ì²˜ë¦¬</b>"]
        direction TB
        subgraph IMG["image_export.py"]
            I1["ì´ë¯¸ì§€ bytes ì¶”ì¶œ"]
            I2["íŒŒì¼ëª… ìƒì„±"]
            I3["assets/ì— ì €ì¥"]
            I1 --> I2 --> I3
        end

        subgraph SUM["summarizer.py"]
            S1["ì„¹ì…˜ë³„ ìš”ì•½<br/><small>SECTION_SUMMARY_PROMPT</small>"]
            S2["ì „ì²´ ê°œìš”<br/><small>PAPER_OVERVIEW_PROMPT</small>"]
            S3["ë©”íƒ€ë°ì´í„° ì¶”ì¶œ<br/><small>METADATA_EXTRACT_PROMPT</small>"]
        end

        subgraph OLL["ğŸ¦™ <b>Ollama API</b>"]
            O1["litellm.completion()"]
            O2["ollama/qwen3:14b"]
            O1 --> O2
        end

        S1 & S2 & S3 --> O1
    end

    subgraph GENERATE["<b>4ë‹¨ê³„: ìƒì„±</b><br/>markdown_gen.py"]
        direction TB
        G1["Frontmatter ìƒì„±"]
        G2["ëª©ì°¨ ìƒì„±"]
        G3["ì„¹ì…˜ë³„ ìš”ì•½ ì‚½ì…"]
        G4["ì´ë¯¸ì§€ ë§í¬ êµì²´"]
        G1 --> G2 --> G3 --> G4
    end

    subgraph OUT["<b>ì¶œë ¥</b>"]
        direction TB
        O_MD["ğŸ“ {paper_name}.md"]
        O_IMG["ğŸ–¼ï¸ assets/*.png"]
    end

    EXTRACT --> PARALLEL
    PARALLEL --> GENERATE
    GENERATE --> OUT

    style OLL fill:#ff6b6b,stroke:#ff4757,stroke-width:3px
    style O2 fill:#ff4757,color:#fff
            </div>
        </div>

        <!-- Ollama ì—°ë™ ìƒì„¸ -->
        <div class="diagram-section">
            <h2>ğŸ¦™ Ollama LLM ì—°ë™ ìƒì„¸</h2>
            <div class="mermaid">
sequenceDiagram
    autonumber
    participant P as pipeline.py
    participant S as summarizer.py
    participant L as litellm
    participant O as ğŸ¦™ Ollama<br/>(localhost:11434)

    Note over P,O: ë…¼ë¬¸ ì²˜ë¦¬ ì‹œì‘

    P->>S: summarize_paper(structure)

    rect rgb(255, 230, 230)
        Note over S,O: ì „ì²´ ê°œìš” ìš”ì•½
        S->>S: PAPER_OVERVIEW_PROMPT ìƒì„±
        S->>L: completion(model="ollama/qwen3:14b")
        L->>O: POST /api/chat
        O-->>L: í•œêµ­ì–´ ìš”ì•½ ì‘ë‹µ
        L-->>S: response.choices[0].message.content
    end

    rect rgb(230, 255, 230)
        Note over S,O: ì„¹ì…˜ë³„ ìš”ì•½ (ë°°ì¹˜ ë³‘ë ¬)
        loop ë°°ì¹˜ë‹¹ 3ê°œ ì„¹ì…˜
            S->>S: SECTION_SUMMARY_PROMPT ìƒì„±
            par ë³‘ë ¬ ìš”ì²­
                S->>L: completion() #1
                S->>L: completion() #2
                S->>L: completion() #3
            end
            L->>O: 3ê°œ ë™ì‹œ ìš”ì²­
            O-->>L: ì‘ë‹µë“¤
            L-->>S: ìš”ì•½ ê²°ê³¼ë“¤
        end
    end

    rect rgb(230, 230, 255)
        Note over S,O: ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
        S->>S: METADATA_EXTRACT_PROMPT ìƒì„±
        S->>L: completion()
        L->>O: POST /api/chat
        O-->>L: JSON ì‘ë‹µ
        L-->>S: {authors, journal, year}
    end

    S-->>P: summaries dict ë°˜í™˜
            </div>
        </div>

        <!-- íŒŒì¼ êµ¬ì¡° -->
        <div class="diagram-section">
            <h2>ğŸ“ íŒŒì¼ êµ¬ì¡° ë° í•¨ìˆ˜</h2>
            <div class="file-details">
                <div class="file-card">
                    <h3>ğŸ“„ main.py</h3>
                    <p>CLI ì§„ì…ì  ë° ëª…ë ¹ì–´ ë¼ìš°íŒ…</p>
                    <ul>
                        <li><code>main()</code> - argparse ì„¤ì •</li>
                        <li><code>cmd_process(args)</code> - ë‹¨ì¼ PDF</li>
                        <li><code>cmd_process_all(args)</code> - í´ë” ì „ì²´</li>
                        <li><code>cmd_watch(args)</code> - ê°ì‹œ ëª¨ë“œ</li>
                        <li><code>cmd_init(args)</code> - ì„¤ì • ìƒì„±</li>
                        <li><code>warmup_models()</code> - ëª¨ë¸ í”„ë¦¬ë¡œë“œ</li>
                    </ul>
                </div>

                <div class="file-card">
                    <h3>ğŸ“„ src/pipeline.py</h3>
                    <p>í•µì‹¬ íŒŒì´í”„ë¼ì¸ - PaperPipeline í´ë˜ìŠ¤</p>
                    <ul>
                        <li><code>__init__(config)</code> - ëª¨ë“ˆ ì´ˆê¸°í™”</li>
                        <li><code>process(pdf_path)</code> - 4ë‹¨ê³„ ì²˜ë¦¬</li>
                        <li><code>_generate_enhanced_markdown()</code></li>
                        <li><code>_generate_frontmatter()</code></li>
                        <li><code>_generate_toc()</code></li>
                        <li><code>_replace_image_links()</code></li>
                        <li><code>_add_summaries_to_markdown()</code></li>
                    </ul>
                </div>

                <div class="file-card">
                    <h3>ğŸ“„ src/extractor.py</h3>
                    <p>marker-pdf ê¸°ë°˜ PDF íŒŒì‹±</p>
                    <ul>
                        <li><code>PDFExtractor</code> í´ë˜ìŠ¤ (ì‹±ê¸€í†¤)</li>
                        <li><code>extract(pdf_path)</code> â†’ PaperStructure</li>
                        <li><code>get_extractor()</code> - ì‹±ê¸€í†¤ ë°˜í™˜</li>
                        <li><code>warmup_extractor()</code> - ëª¨ë¸ í”„ë¦¬ë¡œë“œ</li>
                    </ul>
                    <p style="margin-top:10px"><b>ì¶œë ¥:</b> PaperStructure</p>
                    <ul>
                        <li>title, markdown, sections[]</li>
                        <li>figures[], tables[], images{}</li>
                    </ul>
                </div>

                <div class="file-card ollama-highlight">
                    <h3>ğŸ¦™ src/summarizer.py</h3>
                    <p><b>Ollama ì—°ë™</b> - litellm ê¸°ë°˜ LLM ìš”ì•½</p>
                    <ul>
                        <li><code>Summarizer</code> í´ë˜ìŠ¤</li>
                        <li><code>_call_llm(prompt)</code> - LLM í˜¸ì¶œ</li>
                        <li><code>summarize_paper(structure)</code></li>
                        <li><code>summarize_section(section)</code></li>
                        <li><code>extract_metadata(structure)</code></li>
                        <li><code>_summarize_from_markdown()</code></li>
                    </ul>
                    <p style="margin-top:10px"><b>í”„ë¡¬í”„íŠ¸:</b></p>
                    <ul>
                        <li><code>SECTION_SUMMARY_PROMPT</code></li>
                        <li><code>PAPER_OVERVIEW_PROMPT</code></li>
                        <li><code>METADATA_EXTRACT_PROMPT</code></li>
                    </ul>
                </div>

                <div class="file-card">
                    <h3>ğŸ“„ src/image_export.py</h3>
                    <p>ì´ë¯¸ì§€ ì €ì¥ ë° íŒŒì¼ëª… ìƒì„±</p>
                    <ul>
                        <li><code>ImageExporter</code> í´ë˜ìŠ¤</li>
                        <li><code>export_all(structure, output_dir)</code></li>
                        <li><code>sanitize_filename()</code></li>
                        <li><code>create_short_paper_name()</code></li>
                    </ul>
                </div>

                <div class="file-card">
                    <h3>ğŸ“„ src/markdown_gen.py</h3>
                    <p>Obsidian í˜¸í™˜ ë§ˆí¬ë‹¤ìš´ ìƒì„±</p>
                    <ul>
                        <li><code>MarkdownGenerator</code> í´ë˜ìŠ¤</li>
                        <li><code>generate(structure, summaries, images)</code></li>
                        <li><code>_generate_frontmatter()</code></li>
                        <li><code>_generate_toc()</code></li>
                        <li><code>_format_summary()</code></li>
                        <li><code>save_markdown()</code></li>
                    </ul>
                </div>

                <div class="file-card">
                    <h3>ğŸ“„ src/watcher.py</h3>
                    <p>watchdog ê¸°ë°˜ í´ë” ê°ì‹œ</p>
                    <ul>
                        <li><code>FolderWatcher</code> í´ë˜ìŠ¤</li>
                        <li><code>start(blocking)</code></li>
                        <li><code>stop()</code></li>
                        <li><code>process_existing()</code></li>
                        <li><code>PDFHandler</code> - ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬</li>
                    </ul>
                </div>

                <div class="file-card">
                    <h3>âš™ï¸ config.yaml</h3>
                    <p>ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •</p>
                    <ul>
                        <li><code>llm.provider</code>: "ollama"</li>
                        <li><code>llm.model</code>: "qwen3:14b"</li>
                        <li><code>llm.temperature</code>: 0.6</li>
                        <li><code>llm.max_tokens</code>: 2048</li>
                        <li><code>paths.watch_dir</code>: "target-pdf"</li>
                        <li><code>paths.output_dir</code>: "output"</li>
                        <li><code>output.summary_language</code>: "korean"</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ë°ì´í„° íë¦„ -->
        <div class="diagram-section">
            <h2>ğŸ“Š ë°ì´í„° êµ¬ì¡° íë¦„</h2>
            <div class="mermaid">
flowchart LR
    subgraph INPUT
        PDF["ğŸ“„ PDF"]
    end

    subgraph EXTRACT["extractor.py"]
        PS["<b>PaperStructure</b><br/>â€¢ title: str<br/>â€¢ markdown: str<br/>â€¢ sections: Section[]<br/>â€¢ figures: FigureInfo[]<br/>â€¢ tables: TableInfo[]<br/>â€¢ images: dict[str, bytes]"]
    end

    subgraph PROCESS["ë³‘ë ¬ ì²˜ë¦¬"]
        IMG_PATHS["<b>image_paths</b><br/>dict[str, Path]<br/><small>{original: saved_path}</small>"]
        SUMMARIES["<b>summaries</b><br/>dict[str, str]<br/><small>{section_title: summary}</small>"]
        METADATA["<b>metadata</b><br/>dict<br/><small>{authors, journal, year}</small>"]
    end

    subgraph GENERATE["markdown_gen.py"]
        MD_CONTENT["<b>markdown_content</b><br/>str<br/><small>Obsidian í˜¸í™˜ ë§ˆí¬ë‹¤ìš´</small>"]
    end

    subgraph OUTPUT
        FILES["ğŸ“ {paper}.md<br/>ğŸ–¼ï¸ assets/*.png"]
    end

    PDF --> PS
    PS --> IMG_PATHS
    PS --> SUMMARIES
    PS --> METADATA
    IMG_PATHS & SUMMARIES & METADATA --> MD_CONTENT
    MD_CONTENT --> FILES

    style SUMMARIES fill:#ffe066,stroke:#ffd43b
    style METADATA fill:#ffe066,stroke:#ffd43b
            </div>
        </div>

        <!-- CLI ì‚¬ìš©ë²• -->
        <div class="diagram-section">
            <h2>ğŸ’» CLI ëª…ë ¹ì–´</h2>
            <div class="mermaid">
flowchart TB
    subgraph CLI["python main.py [ì˜µì…˜] [ëª…ë ¹ì–´]"]
        direction TB

        subgraph GLOBAL["ì „ì—­ ì˜µì…˜"]
            V["-v, --verbose<br/><small>ìƒì„¸ ë¡œê·¸</small>"]
            C["-c, --config<br/><small>ì„¤ì • íŒŒì¼ ê²½ë¡œ</small>"]
        end

        subgraph COMMANDS["ëª…ë ¹ì–´"]
            PROC["<b>process</b> &lt;pdf&gt;<br/><small>ë‹¨ì¼ PDF ì²˜ë¦¬</small>"]
            PROCA["<b>process-all</b> [-f folder]<br/><small>í´ë” ë‚´ ëª¨ë“  PDF</small>"]
            WATCHCMD["<b>watch</b> [--process-existing]<br/><small>í´ë” ê°ì‹œ ëª¨ë“œ</small>"]
            INIT["<b>init</b> [-o output] [-f]<br/><small>ì„¤ì • íŒŒì¼ ìƒì„±</small>"]
        end
    end

    subgraph EXAMPLES["ì‚¬ìš© ì˜ˆì‹œ"]
        EX1["python main.py process paper.pdf"]
        EX2["python main.py process-all -f ./pdfs"]
        EX3["python main.py watch --process-existing"]
        EX4["python main.py -v process paper.pdf"]
    end

    PROC --> EX1
    PROCA --> EX2
    WATCHCMD --> EX3
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #ff6b6b;"></div>
                <span>Ollama LLM ì—°ë™</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #ffe066;"></div>
                <span>LLM ìš”ì•½ ì²˜ë¦¬</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #00d4ff;"></div>
                <span>í•µì‹¬ íŒŒì´í”„ë¼ì¸</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #e3f2fd;"></div>
                <span>ë³‘ë ¬ ì²˜ë¦¬ ì˜ì—­</span>
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                showSequenceNumbers: true
            }
        });
    </script>
</body>
</html>
